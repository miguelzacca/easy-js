"use strict";const url=document.currentScript.getAttribute("data-url");function styleDocument(){const t=document.createElement("link");Object.assign(t,{rel:"stylesheet",href:"https://easy-js.netlify.app/assets/lib/easy-form.css"}),document.head.prepend(t)}function throwResultDialog(t){const e=document.createElement("dialog");e.id="result-dialog";const n=document.createElement("button");Object.assign(n,{textContent:"Close",onclick:()=>{e.remove()}});const o=document.createElement("div");o.appendChild(t),e.appendChild(o),e.appendChild(n),document.body.appendChild(e),e.showModal()}function throwHtmlTable(t){const e=document.createElement("table"),n=document.createElement("thead"),o=document.createElement("tbody"),r=Object.keys(t[0]),s=document.createElement("tr");for(const t of r){const e=document.createElement("th");e.textContent=t,s.appendChild(e)}n.appendChild(s);for(const e of t){const t=Object.values(e),n=document.createElement("tr");for(const e of t){const t=document.createElement("td");t.textContent=e,n.appendChild(t)}o.appendChild(n)}e.appendChild(n),e.appendChild(o),throwResultDialog(e)}function isObjectMsg(t){const e=Object.keys(t),n=t[e[0]];if("string"==typeof n&&1===e.length)return n}function handleJsonResponse(t){const e="object"==typeof t,n=e&&isObjectMsg(t);n?throwTextResult(n):e?throwHtmlTable(Array.isArray(t)?t:[t]):throwTextResult(t)}function throwTextResult(t){if(!t)return;const e=document.createElement("p");Object.assign(e,{id:"result-text",textContent:t}),throwResultDialog(e)}function filterValidProps(t){for(const e in t)"_"!==e[0]&&t[e]||delete t[e];return t}function getParams(t){const e=t.filter((([t,e])=>t.includes("_param")&&e));let n="";for(const[t,o]of e)n+=`/${o}`;return n}function getQueries(t){const e=t.filter((([t,e])=>t.includes("_query")&&e));let n=e.length>0?"?":"";for(const[t,o]of e){const e=t.split("_")[2];n+=`${n.length>1?"&":""}${e}=${o}`}return n}async function throwErrorResponse(t){const{status:e,statusText:n}=t,o=await t.json().catch(console.error),r="string"==typeof o?o:"object"==typeof o&&isObjectMsg(o),s=document.createElement("div");s.id="error-result";const c=document.createElement("h2");c.textContent=String(e);const a=document.createElement("p");throw a.textContent=r||n,s.appendChild(c),s.appendChild(a),throwResultDialog(s),t}function fetchHandler({params:t,queries:e,formObj:n,stdMethod:o}){const{_endpoint:r,_method:s}=n,c=s||o,a=r||"",l=filterValidProps(n),d="get"!==c.toLowerCase()?{method:c,headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}:void 0;fetch(`${url}${a}${t}${e}`,d).then((t=>t.ok?t.json():throwErrorResponse(t))).then(handleJsonResponse).catch((t=>throwTextResult(t.message)))}function bootstrap(){if(!url){const t="Atributo data-url faltando na tag script";throw throwTextResult(t),new Error(t)}for(const t of document.querySelectorAll("form"))t.addEventListener("submit",(e=>{e.preventDefault();const n=[...new FormData(t).entries()];fetchHandler({params:getParams(n),queries:getQueries(n),formObj:Object.fromEntries(n),stdMethod:t.method})}))}styleDocument(),addEventListener("DOMContentLoaded",bootstrap);